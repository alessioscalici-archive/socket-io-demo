angular.module("DemoApp",["ngTouch","ui.router","templates-main"]),angular.module("DemoApp").constant("URL",{socketio:"http://185.13.90.140:8081/"}),angular.module("DemoApp").config(function($stateProvider,$urlRouterProvider){"use strict";$urlRouterProvider.otherwise("/chat"),$stateProvider.state("app",{"abstract":!0,templateUrl:"modules/DemoApp/templates/index.jade",controller:"ApplicationCtrl"}).state("app.chat",{url:"/chat",templateUrl:"modules/DemoApp/templates/chat.jade",controller:"ChatCtrl"}).state("app.carousel",{url:"/carousel",templateUrl:"modules/DemoApp/templates/carousel.jade",controller:"CarouselCtrl"}).state("app.settings",{url:"/settings",templateUrl:"modules/DemoApp/templates/settings.jade",controller:"SettingsCtrl"})}),angular.module("DemoApp").run(function($rootScope,ChatSocket){ChatSocket.on("message",function(data){$rootScope.$broadcast("NEW_MESSAGE",data),$rootScope.$digest()})}),angular.module("DemoApp").controller("ApplicationCtrl",function($scope,$state,ChatSocket){"use strict";$scope.messages=[],$scope.unreadMsgFlag=!1;var listeners=[$scope.$on("NEW_MESSAGE",function(ev,data){data.date=new Date,$scope.messages.push(data),"app.chat"!==$state.current.name&&($scope.unreadMsgFlag=!0)}),$scope.$on("$destroy",function(ev){angular.forEach(listeners,function(detach){detach()})})]}),angular.module("DemoApp").controller("CarouselCtrl",function($scope,$timeout,Current,LoremPixelSvc){"use strict";$scope.loadNewPicture=function(){$scope.images.push({source:LoremPixelSvc.getRandomPicUrl()})},$scope.images=[]}),angular.module("DemoApp").controller("ChatCtrl",function($scope,Current,ChatSocket){"use strict";$scope.postMsg=function(){var msg={user:Current.settings.chat.username,date:new Date,message:$scope.newMessageText,outgoing:!0};ChatSocket.emit("message",msg),$scope.messages.push(msg),$scope.newMessageText=""},$scope.unreadMsgFlag=!1}),angular.module("DemoApp").controller("SettingsCtrl",function($scope,Current){"use strict";$scope.settings=Current.settings}),angular.module("DemoApp").directive("activeSpy",function($state){"use strict";return{restrict:"A",link:function(scope,element,attrs){var updateClass=function(stateName){stateName===attrs.uiSref?element.addClass("active"):element.removeClass("active")};updateClass($state.current.name);var listeners=[scope.$on("$stateChangeSuccess",function(event,toState){updateClass(toState.name)}),scope.$on("$destroy",function(){angular.forEach(listeners,function(detach){detach()})})]}}}),angular.module("DemoApp").directive("messageItem",function(){"use strict";return{restrict:"E",replace:!0,scope:{msg:"=message"},templateUrl:"modules/DemoApp/directives/messageItem/messageItem.jade",link:function(scope,element,attrs){scope.msg.outgoing&&(element.addClass("from-me"),element.parent().addClass("from-me"))}}}),angular.module("DemoApp").directive("myAccordion",function(){"use strict";return{restrict:"E",transclude:!0,template:'<div class="my-accordion" ng-transclude></div>'}}),angular.module("DemoApp").directive("myAccordionPane",function(){"use strict";return{restrict:"E",transclude:!0,scope:{},template:'<a href="" ng-click="toggle()">{{headerText}}</a><div class="ma-pane-content" ng-transclude></div>',link:function(scope,element,attrs){scope.headerText=attrs.header,scope.toggle=function(){var opened=element.hasClass("open");element.parent().find("my-accordion-pane").removeClass("open"),opened||element.addClass("open")}}}}),angular.module("DemoApp").directive("myCarousel",function($timeout,Current){"use strict";return{restrict:"E",scope:{images:"=",loadImage:"="},templateUrl:"modules/DemoApp/directives/myCarousel/myCarousel.jade",link:function(scope,element,attrs){scope.nextSlide=function(){"function"==typeof scope.loadImage&&scope.images.length===scope.currentIndex+1&&scope.loadImage(),scope.currentIndex<scope.images.length-1&&(element.find("li").removeClass("active"),$timeout(function(){angular.element(element.find("li")[++scope.currentIndex]).addClass("active")}))},scope.prevSlide=function(){scope.currentIndex>0&&(element.find("li").removeClass("active"),angular.element(element.find("li")[--scope.currentIndex]).addClass("active"))},scope.currentIndex=scope.images.length-1,scope.settings=Current.settings.carousel,$timeout(function(){scope.nextSlide()})}}}),angular.module("DemoApp").factory("ChatSocket",function(URL){return io.connect(URL.socketio)}),angular.module("DemoApp").service("Current",function(){"use strict";var me={settings:{carousel:{width:400,height:200},chat:{username:"default_user"}}};return me}),angular.module("DemoApp").service("LoremPixelSvc",function(Current){"use strict";var picCategories=["abstract","animals","business","cats","city","food","nightlife","fashion","people","nature","sports","technics","transport"];return{getRandomPicUrl:function(){var category=picCategories[Math.floor(100*Math.random())%picCategories.length],index=Math.floor(10*Math.random()),grayscale=Math.random()<.5?"/g":"",width=Current.settings.carousel.width,height=Current.settings.carousel.height;return"http://lorempixel.com"+grayscale+"/"+width+"/"+height+"/"+category+"/"+index}}});